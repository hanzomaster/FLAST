services:
  # Run all experiments
  experiments:
    build:
      context: .
      target: production
    volumes:
      - ./results:/app/results
    command: >
      sh -c "
        echo 'Running RQ1 & RQ2: Effectiveness and Efficiency...' &&
        python src/eff_eff.py &&
        echo 'Running RQ3: Comparison with Pinto-KNN...' &&
        python src/compare_pinto.py &&
        echo 'All experiments completed. Results saved to results/'
      "

  # Run only RQ1 & RQ2
  eff-eff:
    build:
      context: .
      target: production
    volumes:
      - ./results:/app/results
    command: python src/eff_eff.py

  # Run only RQ3
  compare-pinto:
    build:
      context: .
      target: production
    volumes:
      - ./results:/app/results
    command: python src/compare_pinto.py

  # Run parameter tuning
  params:
    build:
      context: .
      target: production
    volumes:
      - ./results:/app/results
    command: python src/params.py

  # Run tests
  test:
    build:
      context: .
      target: development
    command: pytest tests/ -v --cov=src --cov-report=term-missing

  # Run linting
  lint:
    build:
      context: .
      target: development
    command: >
      sh -c "
        echo 'Running Ruff linter...' &&
        ruff check src/ tests/ &&
        echo 'Running Ruff formatter check...' &&
        ruff format --check src/ tests/ &&
        echo 'All checks passed!'
      "

  # Interactive shell for development
  shell:
    build:
      context: .
      target: development
    volumes:
      - ./src:/app/src
      - ./tests:/app/tests
      - ./results:/app/results
    command: /bin/bash
    stdin_open: true
    tty: true
